<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>自动文字图标</title>
</head>
<body>
<div style="display: flex;justify-content: center">
    <div style="max-width: 750px;border: 1px solid #888888;flex-grow: 2">

        <h1>自动文字图标</h1>
        <hr>
        <p>
            自动将 <code>img</code>中src的文字转为文字图标。
        </p>
        <p>
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="pt-fakeimg/测" alt="" class="img-test">
            <img src="pt-fakeimg/试验" alt="" class="img-test">
            <img src="pt-fakeimg/123" alt="" class="img-test">
            <img src="pt-fakeimg/A" alt="" class="img-test">
            <img src="pt-fakeimg/GAME" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
        </p>
    </div>
</div>
<script>
    window.onload = function () {
        pt_t2i = {
            imgList: [],
            init: function () {
                this.imgList = document.querySelectorAll("img")
                return true;
            },
            setfakeimg: function (img) {
                let src=img.getAttribute("src")
                let t=src.slice(src.indexOf("/")+1,src.length)
                let sf=0.8
                let cw=200
                let ch=200
                let tw=cw*sf;
                let th=ch*sf;
                var fakecanvas=document.createElement("canvas")
                fakecanvas.classList=img.classList
                fakecanvas.width=cw
                fakecanvas.height=ch
                var ctx=fakecanvas.getContext("2d")
                console.log(ctx.measureText(t))
                ctx.font = "bold "+th+"px auto";

                ctx.shadowColor="rgba(0,0,0,0.6)"
                ctx.shadowOffsetY=4;
                ctx.shadowBlur=8;

                let fx=cw*(1-sf)/2
                let fy=th

                // 实体文字
                ctx.fillStyle = '#b76251';
                ctx.fillText(t,fx,fy,tw);
                // 实体描边文字
                ctx.strokeStyle = '#f0d5bc';
                ctx.lineWidth = 6;
                ctx.strokeText(t,fx,fy,tw);
                // 虚线描边
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 3]);
                ctx.strokeText(t,fx,fy,tw);

                img.replaceWith(fakecanvas)

            },
            handlelist: function () {
                for(let i=0;i<this.imgList.length;i++){
                    let tmp=this.imgList[i]
                    let src=tmp.getAttribute("src")
                    if(src.indexOf("pt-fakeimg/")===0){
                        this.setfakeimg(tmp)
                    }
                }
            },
            run: function () {
                this.init()
                this.handlelist()
            },
        }
        pt_t2i.run()
    }
</script>
</body>
<style>
    hr {
        border: 0;
        border-top: 1px solid #666666;
    }

    .img-test {
        width: 100px;
        height: 100px;
        border: 1px solid #666666;
    }
</style>
</html>