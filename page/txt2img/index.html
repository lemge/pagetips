<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>自动文字图标</title>
</head>
<body>
<div style="display: flex;justify-content: center">
    <div style="max-width: 750px;border: 1px solid #888888;flex-grow: 2;padding: 5px">

        <h1>自动文字图标</h1>
        <hr>
        <h2>生成base64代码</h2>
        <p>
            以下示例通过文字生成base64代码
        </p>
        <p>
            TODO
        </p>
        <hr>
        <h2>自动转换为SVG格式</h2>
        <p>
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img data-src="pt-fakeimg-svg/测" alt="" class="img-test">
            <img data-src="pt-fakeimg-svg/试验" alt="" class="img-test">
            <img data-src="pt-fakeimg-svg/123" alt="" class="img-test">
            <img data-src="pt-fakeimg-svg/A" alt="" class="img-test">
            <img data-src="pt-fakeimg-svg/GAME" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">

        </p>

        <h2>自动转换为 <code>canvas</code></h2>
        <p>
            自动将 <code>img</code>中src的文字转为文字图标。
        </p>
        <p>
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img data-src="pt-fakeimg/测" alt="" class="img-test">
            <img data-src="pt-fakeimg/试验" alt="" class="img-test">
            <img data-src="pt-fakeimg/123" alt="" class="img-test">
            <img data-src="pt-fakeimg/A" alt="" class="img-test">
            <img data-src="pt-fakeimg/GAME" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
        </p>
        <hr>
        <h2>自动生成base64</h2>

        <p>
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img  data-src="pt-fakeimg-b/测" alt="" class="img-test">
            <img data-src="pt-fakeimg-b/试验" alt="" class="img-test">
            <img data-src="pt-fakeimg-b/123" alt="" class="img-test">
            <img data-src="pt-fakeimg-b/A" alt="" class="img-test">
            <img data-src="pt-fakeimg-b/GAME" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
        </p>
    </div>
</div>
<script>
    window.onload = function () {
        pt_t2i = {
            imgList: [],
            init: function () {
                this.imgList = document.querySelectorAll("img")
                return true;
            },
            setfakeimgsvg:function (img){
                let src=img.getAttribute("data-src")
                let t_str=src.slice(src.indexOf("/")+1,src.length)

                // var svg_ns="http://www.w3.org/200/svg"
                var svg=document.createElement("svg")
                svg.classList=img.classList

                var tag = document.createElement( 'rect')
                tag.setAttribute('width', "100")
                tag.setAttribute('height', "100")
                tag.setAttribute('fill', "rgba(255,255,255,0)")
                tag.setAttribute('stroke-width', "1")
                tag.setAttribute('stroke', "rgb(0,0,255)")
                tag.setAttribute('x', '20')
                tag.setAttribute('y', '20')

                svg.appendChild(tag)

                var t=document.createElement("text")
                t.innerHTML=t_str
                svg.appendChild(t)
                return svg
            },
            setfakeimg: function (img) {
                let src=img.getAttribute("data-src")
                let t=src.slice(src.indexOf("/")+1,src.length)
                let sf=0.7
                let cw=200
                let ch=200
                let tw=cw*sf;
                let th=ch*sf;
                var fakecanvas=document.createElement("canvas")
                fakecanvas.classList=img.classList
                fakecanvas.width=cw
                fakecanvas.height=ch
                var ctx=fakecanvas.getContext("2d")

                ctx.font = "bold "+th+"px auto";

                ctx.shadowColor="rgba(0,0,0,0.6)"
                ctx.shadowOffsetY=2;
                ctx.shadowBlur=4;

                ctx.textAlign="center"
                ctx.textBaseline="middle"

                let fx=cw/2
                let fy=ch/2

                // 实体文字
                ctx.fillStyle = '#b76251';
                ctx.fillText(t,fx,fy,tw);
                // 实体描边文字
                ctx.strokeStyle = '#f0d5bc';
                ctx.lineWidth = 6;
                ctx.strokeText(t,fx,fy,tw);
                // 虚线描边
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 3]);
                ctx.strokeText(t,fx,fy,tw);

                return fakecanvas

            },
            handlelist: function () {
                for(let i=0;i<this.imgList.length;i++){
                    let tmp=this.imgList[i]
                    if(!tmp.dataset.src)
                    {
                        continue
                    }
                    let src=tmp.dataset.src
                    if(src.indexOf("pt-fakeimg/")===0){
                        let fakeimg=this.setfakeimg(tmp)
                        tmp.replaceWith(fakeimg)
                    }else if(src.indexOf("pt-fakeimg-b/")===0){
                        let fakeimg=this.setfakeimg(tmp)
                        let b64str=fakeimg.toDataURL("image/png",1)
                        tmp.setAttribute("src",b64str)
                    }else if(src.indexOf("pt-fakeimg-svg/")===0){
                        let fakeimg=this.setfakeimgsvg(tmp)
                        tmp.replaceWith(fakeimg)
                        // document.querySelector("body").append(fakeimg)
                    }
                }
            },
            run: function () {
                this.init()
                this.handlelist()
            },
        }
        pt_t2i.run()
    }
</script>
</body>
<style>
    hr {
        border: 0;
        border-top: 1px solid #666666;
    }

    .img-test {
        width: 100px;
        height: 100px;
        border: 1px solid #666666;
    }
</style>
</html>