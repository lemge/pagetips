<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>自动文字图标</title>
</head>
<body>
<div style="display: flex;justify-content: center">
    <div style="max-width: 750px;border: 1px solid #888888;flex-grow: 2">

        <h1>自动文字图标</h1>
        <hr>
        <p>
            自动将 <code>img</code>中src的文字转为文字图标。
        </p>
        <p>
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="pt-fakeimg/测" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
        </p>

    </div>
</div>
<script>
    window.onload = function () {
        pt_t2i = {
            imgList: [],
            init: function () {
                this.imgList = document.querySelectorAll("img")
                return true;
            },
            setfakeimg: function (img) {
                let src=img.getAttribute("src")
                let t=src.slice(src.indexOf("/")+1,src.indexOf("/")+2)
                console.log(img.width,img.height)
                let sf=0.9
                let tw=img.width*sf;
                let th=img.height*sf;
                var fakecanvas=document.createElement("canvas")
                fakecanvas.classList=img.classList
                var ctx=fakecanvas.getContext("2d")
                ctx.font = ""+th+"px Arial";
                ctx.fillText(t, 0, th,tw);
                img.replaceWith(fakecanvas)

            },
            handlelist: function () {
                for(let i=0;i<this.imgList.length;i++){
                    let tmp=this.imgList[i]
                    let src=tmp.getAttribute("src")
                    if(src.indexOf("pt-fakeimg/")===0){
                        this.setfakeimg(tmp)
                    }
                }
            },
            run: function () {
                this.init()
                this.handlelist()
            },
        }
        pt_t2i.run()
    }
</script>
</body>
<style>
    hr {
        border: 0;
        border-top: 1px solid #666666;
    }

    .img-test {
        width: 100px;
        height: 100px;
        border: 1px solid #666666;
    }
</style>
</html>