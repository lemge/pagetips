<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>自动文字图标</title>
</head>
<body>
<div style="display: flex;justify-content: center">
    <div style="max-width: 750px;border: 1px solid #888888;flex-grow: 2;padding: 5px">

        <h1>自动文字图标</h1>
        <hr>
        <h2>生成base64代码</h2>
        <p>
            以下示例通过文字生成base64代码
        </p>
        <p>
            请输入文字：
            <input type="text" id="thistxt">
            <button id="stru_img">生成图片</button>
        </p>
        <p>
            Base64:
            <br>
            <img src="" alt="" id="si_img_b64" style="width: 100px;height: 100px">
            <br>
            <textarea id="si_base64" style="width: 80%"></textarea>
        </p>
        <p>
            SVG:
            <br>
            <img src="" alt="" id="si_img_svg" style="width: 100px;height: 100px">
            <br>
            <textarea id="si_svg" style="width: 80%"></textarea>
        </p>
        <hr>
        <h2>自动转换为SVG格式</h2>
        <p>
            <svg class="img-test" id="fimg1"><defs><filter id="f1" x="0" y="0" width="200%" height="200%"><feOffset result="offOut" in="SourceAlpha" dx="2" dy="2"></feOffset><feGaussianBlur result="blurOut" in="offOut" stdDeviation="2"></feGaussianBlur><feBlend in="SourceGraphic" in2="blurOut" mode="normal"></feBlend></filter></defs><text x="50" y="50" font-size="70" font-weight="bold" fill="#5b21b6" style="dominant-baseline:middle;text-anchor:middle;" stroke="#ddd6fe" stroke-width="1.75" filter="url(#f1)">测</text></svg>
        <hr>

            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img data-src="pt-fakeimg-svg/测" alt="" class="img-test">
            <img data-src="pt-fakeimg-svg/试验" alt="" class="img-test">
            <img data-src="pt-fakeimg-svg/123" alt="" class="img-test">
            <img data-src="pt-fakeimg-svg/A" alt="" class="img-test">
            <img data-src="pt-fakeimg-svg/GAME" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">

        </p>

        <h2>自动转换为 <code>canvas</code></h2>
        <p>
            自动将 <code>img</code>中src的文字转为文字图标。
        </p>
        <p>
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img data-src="pt-fakeimg/测" alt="" class="img-test">
            <img data-src="pt-fakeimg/试验" alt="" class="img-test">
            <img data-src="pt-fakeimg/123" alt="" class="img-test">
            <img data-src="pt-fakeimg/A" alt="" class="img-test">
            <img data-src="pt-fakeimg/GAME" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
        </p>
        <hr>
        <h2>自动生成base64</h2>

        <p>
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img data-src="pt-fakeimg-b/测" alt="" class="img-test">
            <img data-src="pt-fakeimg-b/试验" alt="" class="img-test">
            <img data-src="pt-fakeimg-b/123" alt="" class="img-test">
            <img data-src="pt-fakeimg-b/A" alt="" class="img-test">
            <img data-src="pt-fakeimg-b/GAME" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
            <img src="ico.gif" alt="" class="img-test">
        </p>
    </div>
</div>
<script>
    window.onload = function () {
        pt_t2i = {
            sf:0.7,
            imgList: [],
            init: function () {
                this.imgList = document.querySelectorAll("img")
                return true;
            },
            strusvgimg:function (pars){

                var svg_ns="http://www.w3.org/2000/svg"
                var svg=document.createElementNS(svg_ns,"svg")


                let img_w=pars.width
                let img_h=pars.height
                let font_size=img_w*this.sf

                let len=pars.txt.length
                font_size=font_size/len


                var defs=document.createElementNS(svg_ns,"defs")
                svg.appendChild(defs)
                var filter=document.createElementNS(svg_ns,"filter")
                defs.appendChild(filter)
                filter.setAttributeNS(null,"id","f1")
                filter.setAttributeNS(null,"x","0")
                filter.setAttributeNS(null,"y","0")
                filter.setAttributeNS(null,"width","200%")
                filter.setAttributeNS(null,"height","200%")

                var feOffset=document.createElementNS(svg_ns,"feOffset")
                filter.appendChild(feOffset)
                feOffset.setAttributeNS(null,"result","offOut")
                feOffset.setAttributeNS(null,"in","SourceAlpha")
                feOffset.setAttributeNS(null,"dx","2")
                feOffset.setAttributeNS(null,"dy","2")

                var feGaussianBlur=document.createElementNS(svg_ns,"feGaussianBlur")
                filter.appendChild(feGaussianBlur)
                feGaussianBlur.setAttributeNS(null,"result","blurOut")
                feGaussianBlur.setAttributeNS(null,"in","offOut")
                feGaussianBlur.setAttributeNS(null,"stdDeviation","2")

                var feBlend=document.createElementNS(svg_ns,"feBlend")
                filter.appendChild(feBlend)
                feBlend.setAttributeNS(null,"in","SourceGraphic")
                feBlend.setAttributeNS(null,"in2","blurOut")
                feBlend.setAttributeNS(null,"mode","normal")





                var t=document.createElementNS(svg_ns,"text")
                t.innerHTML=pars.txt
                t.setAttributeNS(null,"x",img_w/2)
                t.setAttributeNS(null,'y',img_h/2)
                t.setAttributeNS(null,"font-size",font_size)
                t.setAttributeNS(null,"font-weight","bold")
                t.setAttributeNS(null,"fill","#5b21b6")
                t.setAttributeNS(null,"style","dominant-baseline:middle;text-anchor:middle;")
                t.setAttributeNS(null,'stroke',"#ddd6fe")
                t.setAttributeNS(null,'stroke-width',font_size/40)
                t.setAttributeNS(null,'filter',"url(#f1)")
                svg.appendChild(t)
                return svg

            },
            setfakeimgsvg:function (img){

                let src=img.dataset.src
                let t_str=src.slice(src.indexOf("/")+1,src.length)

                let svg=this.strusvgimg({
                    width:img.width,
                    height:img.height,
                    txt:t_str,
                })

                svg.classList=img.classList
                return svg
            },
            struCanvas:function (pars){

                let sf=this.sf
                let cw=200
                let ch=200
                let tw=cw*sf;
                let th=ch*sf;

                var fakecanvas=document.createElement("canvas")

                fakecanvas.width=cw
                fakecanvas.height=ch
                var ctx=fakecanvas.getContext("2d")

                ctx.font = "bold "+th+"px auto";

                ctx.shadowColor="rgba(0,0,0,0.6)"
                ctx.shadowOffsetY=2;
                ctx.shadowBlur=4;

                ctx.textAlign="center"
                ctx.textBaseline="middle"

                let fx=cw/2
                let fy=ch/2

                // 实体文字
                ctx.fillStyle = '#b76251';
                ctx.fillText(pars.txt,fx,fy,tw);
                // 实体描边文字
                ctx.strokeStyle = '#f0d5bc';
                ctx.lineWidth = 6;
                ctx.strokeText(pars.txt,fx,fy,tw);
                // 虚线描边
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 3]);
                ctx.strokeText(pars.txt,fx,fy,tw);

                return fakecanvas;


            },
            setfakeimg: function (img) {
                let src=img.getAttribute("data-src")
                let t=src.slice(src.indexOf("/")+1,src.length)
                let fakecanvas=this.struCanvas({
                    txt:t,
                })
                fakecanvas.classList=img.classList
                return fakecanvas

            },
            handlelist: function () {
                for(let i=0;i<this.imgList.length;i++){
                    let tmp=this.imgList[i]
                    if(!tmp.dataset.src)
                    {
                        continue
                    }
                    let src=tmp.dataset.src
                    if(src.indexOf("pt-fakeimg/")===0){
                        let fakeimg=this.setfakeimg(tmp)
                        tmp.replaceWith(fakeimg)
                    }else if(src.indexOf("pt-fakeimg-b/")===0){
                        let fakeimg=this.setfakeimg(tmp)
                        let b64str=fakeimg.toDataURL("image/png",1)
                        tmp.setAttribute("src",b64str)
                    }else if(src.indexOf("pt-fakeimg-svg/")===0){
                        let fakeimg=this.setfakeimgsvg(tmp)

                        tmp.replaceWith(fakeimg)
                        // document.querySelector("body").append(fakeimg)
                    }
                }
            },
            run: function () {
                this.init()
                this.handlelist()
            },
        }
        pt_t2i.run()

    }
    document.querySelector("#stru_img").addEventListener("click",function () {
        var t=document.querySelector("#thistxt").value;
        var svgObj=pt_t2i.strusvgimg({
            width:100,
            height:100,
            txt:t
        })
        document.querySelector("#si_svg").value="<svg>"+svgObj.innerHTML+"</svg>"
        let svg_rep_img=document.querySelector("#si_img_svg")
        svgObj.setAttribute("id",svg_rep_img.getAttribute("id"))
        svgObj.setAttribute("style",svg_rep_img.getAttribute("style"))
        svg_rep_img.replaceWith(svgObj)
        var canvasStr=pt_t2i.struCanvas({
            txt:t,
        })
        let b64Str=canvasStr.toDataURL("image/png",1);
        document.querySelector("#si_base64").value=b64Str
        document.querySelector("#si_img_b64").setAttribute("src",b64Str)
    })
</script>
</body>
<style>
    hr {
        border: 0;
        border-top: 1px solid #666666;
    }

    .img-test {
        width: 100px;
        height: 100px;
        border: 1px solid #666666;
    }
</style>
</html>